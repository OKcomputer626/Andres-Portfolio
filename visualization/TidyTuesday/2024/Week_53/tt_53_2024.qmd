---
title: ""
description: ""
lightbox: true
date: today
categories: [TidyTuesday, R Programming, Data Visualization]
tags: [ggplot2, data-visualization, tidyverse]
image: ""
editor_options: 
  chunk_output_type: inline
---

### <mark> **How This Graphic Was Made** </mark>

#### 1. ðŸ“¦ Load Packages & Setup

```{r}
#| label: load
#| warning: false
#| message: false
#| results: hide


# Load necessary packages using pacman for easier dependency management
pacman::p_load(
  tidyverse,   # Collection of R packages for data science (ggplot2, dplyr, etc.)
  showtext,    # Enables custom fonts for ggplot2
  ggtext,      # Adds rich text formatting to ggplot2
  skimr,       # Provides summary statistics in a readable format
  glue
)

# Add custom Google fonts for use in plots
font_add_google("Roboto Condensed")
font_add_google("Oswald")

# Load a specific font from a local file (Font Awesome for branding/icons)
font_add("Font Awesome 6 Brands", here::here("fonts/otfs/Font Awesome 6 Brands-Regular-400.otf"))

# Automatically enable the use of showtext for all plots
showtext_auto()

# Set DPI for high-resolution text rendering
showtext_opts(dpi = 300)
```

#### 2. ðŸ“– Read in the Data

```{r}
#| label: read
#| include: true
#| eval: true
#| warning: false

# Load the TidyTuesday data
tuesdata <- tidytuesdayR::tt_load(2024, week = 53)

broadcast_media <- tuesdata$broadcast_media

tidytuesdayR::readme(tuesdata)

# Remove the original list (tuesdata) from the environment to free up space
rm(tuesdata)
```

#### 3. ðŸ•µï¸ Examine the Data

```{r}
#| label: examine
#| include: true
#| eval: true
#| results: hide
#| warning: false

glimpse(broadcast_media)

skim(broadcast_media)
```

#### 4. ðŸ¤¼ Wrangle Data

```{r}
#| label: wrangle
#| warning: false

# Step 1: Get top 4 affiliations by frequency, normalize case
top_affiliations <- broadcast_media %>%
  filter(year >= max(year) - 5) %>%
  mutate(affiliation = str_split(affiliation, ",")) %>%
  unnest(affiliation) %>%
  mutate(affiliation = str_trim(affiliation),
         affiliation = str_to_lower(affiliation)) %>%  # Convert to lowercase
  group_by(affiliation) %>%
  count() %>%
  ungroup() %>%
  slice_max(order_by = n, n = 4, with_ties = FALSE) %>%
  pull(affiliation)

# Step 2: Filter and Extract rows mentioning top 4 affiliations (normalized)
df <- broadcast_media %>%
  filter(year >= max(year) - 5) %>%
  mutate(affiliation = str_split(affiliation, ",")) %>%
  unnest(affiliation) %>%
  mutate(affiliation = str_trim(affiliation),
         affiliation = str_to_lower(affiliation)) %>%  # Normalize during filtering
  filter(str_detect(affiliation, paste(top_affiliations, collapse = "|"))) %>%
  mutate(affiliation = str_extract(affiliation, paste(top_affiliations, collapse = "|")))

# Step 3: Create Logo Mapping for Top Affiliations
logo_df <- tribble(
  ~affiliation, ~logo,
  "youtube", "youtube_logo.png",
  "netflix", "netflix_logo.png",
  "itunes", "itunes_logo.png",
  "instagram", "instagram_logo.png"
) |>
  mutate(
    logo = here::here("visualization", "TidyTuesday", "2024", "Week_53", "logo", logo)  # Path to logos
  )

# Step 4: Join Logos with Data
df <- df %>%
  left_join(logo_df, by = "affiliation") %>%
  mutate(
    logo_label = ifelse(
      affiliation == "itunes",
      glue::glue("<img src='{logo}' width='35'/>"),  # Smaller for iTunes
      glue::glue("<img src='{logo}' width='50'/>")   # Default size for others
    )
  )

print(df)
```

#### 5. ðŸ”¤ Text

```{r}
#| label: text
#| include: true
#| warning: false

title <- "James Beard Awards Wins and Nominations Between 2019 to 2024"

subtitle <- "Total Wins and Nominations for the Top Four Broadcast Media Across All Subcategories"

# Create a social media caption with customized colors and font for consistency in visualization
social <- andresutils::social_caption(font_family = "Roboto Condensed", icon_color = "#36454F") 

# Construct the final plot caption by combining TidyTuesday details, data source, and the social caption
cap <- paste0(
  "#TidyTuesday: Week 53, 2024 | **Source**: James Beard Foundation, Wikipedia, curated by Jon Harmon | **Graphic**: ", social
)
```

#### 6. ðŸ“Š Plot

```{r}
#| label: plot
#| warning: false

p <- df %>%
  ggplot(aes(x = factor(year), alpha = rank, fill = factor(year))) +
  geom_dotplot(method = "histodot", binwidth = 1, stackdir = "up",
               stackgroups = TRUE, color="grey50", stackratio = 0.75, dotsize = .6) +
  facet_wrap(vars(logo_label), nrow = 1) +
  scale_alpha_manual(values = c(0.5, 1)) +
  scale_fill_manual(values = c("#ef476f", "#ffd166", "#06d6a0", "#118ab2", "#073b4c")) +
  labs(
    title = title,
    subtitle = subtitle,
    caption = cap
  ) + 
  theme_void() +
  theme(
    text = element_text(family = "Roboto Condensed"),
    plot.title = element_text(hjust = 0.5, family = "Oswald", face = "bold", margin = margin(b = 5, t = 10)),
    plot.subtitle = element_text(hjust = 0.5, margin = margin(b = 10, t = 0)),
    plot.margin = margin(5, 10, 5, 10),
    plot.background = element_rect(fill = "#ffffff", colour = "#ffffff"),
    panel.background = element_rect(fill = "#ffffff", colour = "#ffffff"),
    plot.caption = element_markdown(hjust = 0.5, size = 5, margin = margin(b = 5, t = 10)),
    axis.text.x = element_text(size = 7),
    legend.position = "none",
    strip.text = element_markdown(hjust = 0.5)
  )
```

#### 7. ðŸ’¾ Save

```{r}
#| label: save
#| warning: false

# Save the plot for TidyTuesday 2024, Week 50 with specified dimensions.
andresutils::save_plot(p, type = "tidytuesday", year = 2024, week = 53, width = 8, height = 4.5)
```

#### 8. ðŸš€ GitHub Repository

::: {.callout-tip collapse="true"}
##### Expand for GitHub Repo

The complete code for this analysis is available in [`tt_2024_50.qmd`](https://github.com/OKcomputer626/Andres-Portfolio/blob/master/visualization/TidyTuesday/2024/tt_2024_50.qmd).

For the full repository, [click here](https://github.com/OKcomputer626/Andres-Portfolio).
:::

