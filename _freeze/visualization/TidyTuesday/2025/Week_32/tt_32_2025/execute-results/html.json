{
  "hash": "9ccb88203c83924247d07e7e4f38f792",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Climate Events by Region (2008â€“2024)\"\ndescription: \"Visualizing the top four climate-related event types by region and year using ggplot2 streamgraphs.\"\nlightbox: true\ndate: today\ncategories: [TidyTuesday, R Programming, Data Visualization, Climate]\ntags: [ggplot2, data-visualization, tidyverse]\nimage: \"tt_32_2025.png\"\neditor_options: \n  chunk_output_type: inline\n---\n\n![A faceted streamgraph of the top four climate-related event types (e.g., Drought, Heat, Rain & Flooding, Storm) by region and year from 2008â€“2024. Each row is an event type; stream width encodes the number of attribution studies for each region in that year, so you can quickly compare how regional attention shifts over time.](tt_32_2025.png){#fig-1}\n\n### <mark> **How This Graphic Was Made** </mark>\n\n#### 1. ðŸ“¦ Load Packages & Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary packages using pacman for easier dependency management\npacman::p_load(\n  tidyverse,   # Core data wrangling + plotting (dplyr, ggplot2, readr, etc.)\n  showtext,    # Render non-system / Google fonts in ggplot devices\n  ggtext,      # Rich text in ggplot (HTML/Markdown via element_markdown)\n  skimr,       # Quick, readable data summaries (skim())\n  janitor,     # Data cleaning helpers (clean_names(), tabyl(), remove_empty())\n  glue,        # String interpolation for titles/captions\n  ggstream,    # Streamgraph geoms (geom_stream)\n  cowplot      # Plot composition/annotation (ggdraw, draw_text, plot_grid)\n)\n\n# Add Google fonts\nfont_add_google(\"Bebas Neue\", family = \"Bebas\")\n\n# Add local font\nfont_add(\"Font Awesome 6 Brands\", here::here(\"fonts/otfs/Font Awesome 6 Brands-Regular-400.otf\"))\n\n# Automatically enable the use of showtext for all plots\nshowtext_auto()\n\n# Set DPI for high-resolution text rendering\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n#### 2. ðŸ“– Read in the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load week 32 (2025) TidyTuesday data\ntuesdata <- tidytuesdayR::tt_load(2025, week = 32)\n\n# Extract dataset and clean column names\nattribution <- tuesdata$attribution_studies %>% clean_names()\n\n# Show the README for context\ntidytuesdayR::readme(tuesdata)\n\n# Drop the list to free memory\nrm(tuesdata)\n```\n:::\n\n\n#### 3. ðŸ•µï¸ Examine the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display the structure of the agencies dataset, including column types and sample values\nglimpse(attribution)\n\n# Generate a detailed summary of the agencies dataset, including distribution and missing values\nskim(attribution)\n```\n:::\n\n\n#### 4. ðŸ¤¼ Wrangle Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count rows per study focus (quick sanity check of categories)\nattribution %>%\n  group_by(study_focus) %>%\n  count()\n\n# Identify the four most frequent event types in the entire dataset\nfour_events <- attribution %>%\n  group_by(event_type) %>%\n  count() %>%\n  ungroup() %>%\n  slice_max(n, n = 4) %>%\n  pull(event_type)\n\n# Peek at region and year values for cleaning decisions\nunique(attribution$cb_region)\nunique(attribution$event_year)\n\n# Clean + standardize fields, then aggregate counts by year/type/region\nattribution_clean <- attribution %>%\n  # Keep only event-focused rows and the top-4 event types\n  filter(study_focus == \"Event\",\n         event_type %in% four_events) %>%\n  # Drop missing year strings (ensures parsing below sees non-NA)\n  drop_na(event_year) %>%\n  # Parse event_year to a numeric single year and build region groups\n  mutate(\n    # Normalize event_year to a single numeric year\n    event_year_fixed = case_when(\n      str_detect(event_year, \"^\\\\d{4}$\") ~ as.numeric(event_year),              # exact year (e.g., \"2012\")\n      str_detect(event_year, \"^\\\\d{4}-\\\\d{4}$\") ~ as.numeric(str_sub(event_year, 1, 4)), # year range: take start (e.g., \"2010-2012\" -> 2010)\n      str_detect(event_year, \"^\\\\d{4},\\\\s*\\\\d{4}\") ~ as.numeric(str_extract(event_year, \"^\\\\d{4}\")), # comma list: take first (e.g., \"2010, 2012\")\n      str_detect(event_year, \"\\\\d{4}s\") ~ as.numeric(str_extract(event_year, \"\\\\d{4}\")), # decade label: take decade start (e.g., \"2010s\" -> 2010)\n      str_detect(event_year, \"Mid-1990s\") ~ 1995,                               # special case: mid-1990s -> 1995\n      is.na(event_year) ~ NA_real_,                                             # (note: unreachable here due to drop_na)\n      TRUE ~ NA_real_                                                           # fallback to NA if pattern not matched\n    ),\n    # Collapse CB regions to broader groups used in the figure\n    region_group = case_when(\n      cb_region %in% c(\"Europe\") ~ \"Europe\",\n      cb_region %in% c(\"Northern America\", \"Latin America and the Caribbean\") ~ \"Americas\",\n      cb_region %in% c(\"Sub-Saharan Africa\", \"Northern Africa and western Asia\") ~ \"Africa\",\n      cb_region %in% c(\"Eastern and south-eastern Asia\", \"Central and southern Asia\") ~ \"Asia\",\n      cb_region %in% c(\"Australia and New Zealand\", \"Oceania\") ~ \"Oceania\",\n      cb_region %in% c(\"Arctic\", \"Antarctica\") ~ \"Polar\",\n      cb_region == \"Northern hemisphere\" ~ \"Global/NH\",\n      cb_region == \"Global\" ~ \"Global\",\n      TRUE ~ \"Other\"                                                             # keep a catch-all bucket\n    )\n  ) %>%\n  # Keep only fields needed for plotting and aggregate counts\n  select(event_year_fixed, event_type, region_group) %>%\n  group_by(event_year_fixed, event_type, region_group) %>%\n  count() %>%\n  arrange(desc(n)) %>%\n  ungroup() %>%\n  # Restrict time window to 2008+\n  filter(event_year_fixed >= 2008)\n\n# Recompute top 4 event types within the cleaned window (2008+)\ntop4 <- attribution_clean %>%\n  group_by(event_type) %>%\n  summarise(total = sum(n), .groups = \"drop\") %>%\n  slice_max(total, n = 4) %>%\n  pull(event_type)\n\n# Build the final streamgraph input:\n#  - keep top 4 types\n#  - drop missing groups/years\n#  - ensure every year in each (event_type, region_group) series exists (fill missing with 0)\ndf_stream <- attribution_clean %>%\n  filter(event_type %in% top4,\n         !is.na(event_year_fixed),\n         !is.na(region_group)) %>%\n  group_by(event_type, region_group, event_year_fixed) %>%\n  summarise(n = sum(n), .groups = \"drop\") %>%\n  group_by(event_type, region_group) %>%\n  complete(\n    event_year_fixed = seq(min(event_year_fixed), max(event_year_fixed), by = 1),\n    fill = list(n = 0)\n  ) %>%\n  ungroup()\n```\n:::\n\n\n#### 5. ðŸ”¤ Text\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define the main title for the visualization\ntitle <- \"Climate Events by Region\"\n\n# Create a short description of the dataset focus\nst <- \"Top four climate-related event types by region and year (2008â€“2024).\"\n\n# Generate a social media caption with custom colors and font styling\nsocial <- andresutils::social_caption(font_family = \"Bebas\", icon_color = \"#086ca2\", bg_color = \"#E1EBEE\", font_color = \"grey45\") \n\n# Construct the final plot caption with TidyTuesday details, data source, and social caption\ncap <- paste0(\n  \"#TidyTuesday: Week 32, 2025 | **Source**: Carbon Brief | **Graphic**: \", social\n)\n\n# Discrete palette (8 colors) for event types/regions; pass to scale_*_manual()\npal <- c(\"#715660\", \"#846470\", \"#566071\", \"#727f96\", \"#c39f72\",\"#d5bf95\", \"#667762\", \"#879e82\")\n```\n:::\n\n\n#### 6. ðŸ“Š Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Build the streamgraph of top climate event types by region (2008â€“2024)\np <- df_stream %>%\n  ggplot(aes(\n    x = event_year_fixed,\n    y = n,\n    color = region_group,\n    fill = region_group\n  )) +\n  geom_hline(yintercept = 0, color = \"#E1EBEE\") +\n  geom_stream(extra_span = .2,\n              true_range = \"none\",\n              type = \"mirror\") +\n  geom_vline(\n    data = tibble(x = c(seq(2010, 2024, by = 2))),\n    aes(xintercept = x),\n    inherit.aes = F,\n    color = \"#E1EBEE\",\n    size = .5,\n    linetype = \"dotted\"\n  ) +\n  facet_grid(rows = vars(event_type),\n             scales = \"free_y\",\n             space = \"free\") +\n  scale_x_continuous(\n    limits = c(2008, NA),\n    breaks = seq(2010, 2024, by = 2),\n    position = \"top\"\n  ) +\n  scale_y_continuous(expand = c(.03, .03)) +\n  coord_cartesian(clip = \"off\") +\n  scale_color_manual(expand = c(0, 0),\n                     values = pal,\n                     guide = F) +\n  scale_fill_manual(values = pal, name = NULL) +\n  labs(title = title,\n       subtitle = st,\n       caption = cap) +\n  theme_minimal(base_family = \"Bebas\", base_size = 12) +\n  theme(\n    plot.title = element_text(\n      size = 40,\n      face = \"bold\",\n      hjust = 0.5,\n      margin = margin(10, 0, 10, 0)\n    ),\n    plot.subtitle = element_text(\n      hjust = 0.5,\n      margin = margin(5, 0, 20, 0),\n      color = \"grey35\"\n    ),\n    plot.caption = element_textbox(\n      hjust = 0.5,\n      color = \"grey45\",\n      margin = margin(10, 0, 5, 0)\n    ),\n    axis.text.y = element_blank(),\n    axis.text.x = element_text(size = 20),\n    axis.title = element_blank(),\n    plot.background = element_rect(fill = \"#E1EBEE\", color = NA),\n    panel.grid = element_blank(),\n    panel.spacing.y = unit(0, \"lines\"),\n    strip.text.y = element_blank(),\n    legend.position = \"bottom\",\n    legend.text = element_blank(),\n    legend.direction = \"horizontal\",\n    legend.key.height = unit(0.75, \"cm\"),\n    legend.key.width = unit(3, \"cm\")\n  ) +\n  guides(fill = guide_legend(nrow = 1))\n\n# Compose final graphic and overlay region/event labels with cowplot\nfinal <- ggdraw(p) +\n  annotate(\"text\", x = 0.65, y = 0.75, label = \"European heat attribution peaks in 2018 (14 studies)\", size = 5, color = \"grey35\", family = \"Bebas\") +\n  annotate(\"curve\", x = 0.65, y = 0.74, xend = 0.53, yend = 0.6, curvature = -0.5, arrow = arrow(length = unit(0.5, 'cm'))) +\n  draw_text(\n    text = \"Africa\",\n    x = 0.223,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Americas\",\n    x = 0.305,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Asia\",\n    x = 0.38,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Europe\",\n    x = 0.46,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Global\",\n    x = 0.54,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey10\"\n  ) +\n  draw_text(\n    text = \"Global/NH\",\n    x = 0.62,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey10\"\n  ) +\n  draw_text(\n    text = \"Oceania\",\n    x = 0.70,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Polar\",\n    x = 0.78,\n    y = 0.053,\n    size = 16,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"#F8F8FF\"\n  ) +\n  draw_text(\n    text = \"Drought\",\n    x = 0.03,\n    y = 0.83,\n    size = 24,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey20\",\n    hjust = 0\n  ) +\n  draw_text(\n    text = \"Heat\",\n    x = 0.03,\n    y = 0.65,\n    size = 24,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey20\",\n    hjust = 0\n  ) +\n  draw_text(\n    text = \"Rain & flooding\",\n    x = 0.03,\n    y = 0.46,\n    size = 24,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey20\",\n    hjust = 0\n  ) +\n  draw_text(\n    text = \"Storm\",\n    x = 0.03,\n    y = 0.22,\n    size = 24,\n    family = \"Bebas\",\n    fontface = \"bold\",\n    color = \"grey20\",\n    hjust = 0\n  )\n```\n:::\n\n\n#### 7. ðŸ’¾ Save\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot for TidyTuesday 2025, Week 07 with specified dimensions.\nandresutils::save_plot(final, type = \"tidytuesday\", year = 2025, week = 32, width = 16, height = 12)\n```\n:::\n\n\n#### 8. ðŸš€ GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_32_2025.qmd`](https://github.com/OKcomputer626/Andres-Portfolio/blob/master/visualization/TidyTuesday/2024/tt_32_2025.qmd).\n\nFor the full repository, [click here](https://github.com/OKcomputer626/Andres-Portfolio).\n:::\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}