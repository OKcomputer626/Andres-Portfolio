{
  "hash": "52d2e2a1f72954499f61d611d0b255a9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Historic UK Meteorological & Climate Data\"\ndescription: \"The chart compares total annual rainfall at UK stations in 2023 and 2024 showing that most stations had less rain in 2024 while a few experienced increases including the largest rise at Rossnowye and the biggest drop at Armagh.\"\nlightbox: true\ndate: October 26, 2025\ncategories: [TidyTuesday, R Programming, Data Visualization]\ntags: [ggplot2, tidyverse, rainfall, UK, climate, visualization]\nimage: \"tt_42_2025.png\"\neditor_options: \n  chunk_output_type: inline\n---\n\n![Comparison of total annual rainfall at UK stations in 2023 and 2024 showing that most stations recorded less rain in 2024 while a few saw increases including the largest at Rossnowye and the steepest decline at Armagh.](tt_42_2025.png){#fig-1}\n\n### <mark> **How This Graphic Was Made** </mark>\n\n#### 1. üì¶ Load Packages & Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary packages using pacman for easier dependency management\npacman::p_load(\n  tidyverse,   # Collection of R packages for data science (ggplot2, dplyr, etc.)\n  showtext,    # Enables custom fonts for ggplot2\n  ggtext,      # Adds rich text formatting to ggplot2\n  skimr,       # Provides summary statistics in a readable format\n  janitor,\n  glue,\n  gridmappr,\n  geofacet\n)\n\n# Add Google fonts\nfont_add_google(\"Roboto Condensed\", family = \"Roboto\")\n\n# Add local font\nfont_add(\"Font Awesome 6 Brands\", here::here(\"fonts/otfs/Font Awesome 6 Brands-Regular-400.otf\"))\n\n# Automatically enable the use of showtext for all plots\nshowtext_auto()\n\n# Set DPI for high-resolution text rendering\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n#### 2. üìñ Read in the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the TidyTuesday data\ntuesdata <- tidytuesdayR::tt_load(2025, week = 42)\n\n# Extract dataset and clean column names\nhistoric <- tuesdata$historic_station_met %>% clean_names()\nstation <- tuesdata$station_meta %>% clean_names()\n\n# Show the README for context\ntidytuesdayR::readme(tuesdata)\n\n# Drop the list to free memory\nrm(tuesdata)\n```\n:::\n\n\n#### 3. üïµÔ∏è Examine the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(historic)\nglimpse(station)\n```\n:::\n\n\n#### 4. ü§º Wrangle Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Inputs to grid\npts <- station %>%\n  select(area_name = station, x = lng, y = lat)\n\nsolution <- points_to_grid(\n  pts,\n  n_row = 10, n_col = 10,\n  compactness = 0.6\n)\n\nmy_grid <- solution %>%\n  transmute(name = area_name, code = area_name, row, col) %>%\n  arrange(row, col)\n\n# Flip grid vertically (top-left origin)\nmy_grid_flipped <- my_grid %>%\n  mutate(row = max(row) - row + 1)\n\n# Annual totals\nannual_rain <- historic %>%\n  group_by(station, year) %>%\n  summarise(value = sum(rain, na.rm = TRUE), .groups = \"drop\")\n\n# Choose years (prefer 2023 vs 2024; else earliest vs latest)\nyears_avail <- sort(unique(annual_rain$year))\ntarget_years <- c(2023, 2024)\nif (!all(target_years %in% years_avail)) target_years <- range(years_avail)\nyear_a <- target_years[1]\nyear_b <- target_years[2]\n\n# Keep stations that have both years\ncmp <- annual_rain %>%\n  filter(year %in% c(year_a, year_b)) %>%\n  left_join(station %>% select(station, station_name), by = \"station\") %>%\n  group_by(station) %>%\n  filter(n_distinct(year) == 2) %>%\n  ungroup()\n\nplot_df <- cmp\n\n# Keep only stations that appear on the grid\ngrid_use <- my_grid_flipped %>%\n  semi_join(\n    plot_df %>% distinct(station) %>% rename(code = station),\n    by = \"code\"\n  )\n\n# Align factor order to grid order\nplot_df2 <- plot_df %>%\n  mutate(station = factor(station, levels = grid_use$code))\n\ngrid_use2 <- grid_use %>%\n  mutate(name = str_to_title(name))\n\n# Compare totals between the two years\ndata2 <- plot_df2 %>%\n  group_by(station) %>%\n  summarise(\n    val_a = sum(value[year == year_a], na.rm = TRUE),\n    val_b = sum(value[year == year_b], na.rm = TRUE),\n    .groups = \"drop\"\n  ) %>%\n  mutate(\n    group = if_else(val_b > val_a, \"Increase\", \"Decrease\"),\n    change = val_b - val_a,\n    pct_change = round((change / if_else(val_a == 0, NA_real_, val_a)) * 100, 1)\n  )\n\n# Shares of Increase / Decrease (robust if a group is missing)\npercentage <- data2 %>%\n  count(group, name = \"count\") %>%\n  tidyr::complete(group = c(\"Increase\", \"Decrease\"), fill = list(count = 0)) %>%\n  mutate(relative_frequency = round(count / sum(count), 2))\n\ninc <- percentage %>% filter(group == \"Increase\") %>% pull(relative_frequency) * 100\ndec <- percentage %>% filter(group == \"Decrease\") %>% pull(relative_frequency) * 100\n\n# Largest increase / decrease\nlargest_inc <- data2 %>% filter(change == max(change, na.rm = TRUE)) %>% slice(1)\nlargest_dec <- data2 %>% filter(change == min(change, na.rm = TRUE)) %>% slice(1)\n\nstation_inc <- largest_inc$station\nchange_inc  <- round(largest_inc$change)\npct_inc     <- largest_inc$pct_change\nval_inc_b   <- round(largest_inc$val_b)\n\nstation_dec <- largest_dec$station\nchange_dec  <- round(largest_dec$change)\npct_dec     <- largest_dec$pct_change\nval_dec_b   <- round(largest_dec$val_b)\n\n# explicit counts\ncount_inc <- percentage %>% filter(group == \"Increase\") %>% pull(count)\ncount_dec <- percentage %>% filter(group == \"Decrease\") %>% pull(count)\n\ndata2 <- data2 %>%\n  mutate(\n    group_simple = factor(group, levels = c(\"Increase\", \"Decrease\")),\n    group_label  = case_when(\n      val_b > val_a ~ sprintf(\"Rain (%d) per station > Rain (%d) per station\", year_b, year_a),\n      val_b < val_a ~ sprintf(\"Rain (%d) per station < Rain (%d) per station\", year_b, year_a),\n      TRUE          ~ NA_character_\n    )\n  )\n```\n:::\n\n\n#### 5. üî§ Text\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate a social media caption with custom colors and font styling\nsocial <- andresutils::social_caption(font_family = \"Roboto\", icon_color = \"#0063B2\") \n\n# Construct the final plot caption with TidyTuesday details, data source, and social caption\ncap <- paste0(\n  \"#TidyTuesday: Week 42, 2025 | **Source**: Historical monthly data for meteorological stations | **Graphic**: \", social\n)\n\ntitle <- \"Rainfall in <span style='color:grey50;'>2023</span> vs <span style='color:#0063B2;'>2024</span> Across UK Stations\"\n\nsubtitle <- glue(\n  \"<b>{round(inc)}%</b> (<b>{count_inc} stations</b>) recorded higher rainfall in \n  <span style='color:#0063B2;'>2024</span> than in \n  <span style='color:grey50;'>2023</span>, while <b>{round(dec)}%</b> (<b>{count_dec} stations</b>) saw a decline. \n  The largest increase occurred at <b>{station_inc}</b>, rising by <b>{change_inc} mm</b> \n  (<b>{pct_inc}%</b>) to <b>{val_inc_b} mm</b> in 2024, \n  while <b>{station_dec}</b> recorded the sharpest drop of <b>{abs(change_dec)} mm</b> \n  (<b>{abs(pct_dec)}%</b>). \n  Even after more than a century of records, the story of rainfall in the United Kingdom continues to change and shows how local weather patterns are always in motion.\"\n)\n```\n:::\n\n\n#### 6. üìä Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# rectangle\nbg_df <- data2 %>%\n  transmute(station, group_simple, group_label,\n            xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf)\n\n# plot\np <- plot_df2 %>%\n  ggplot(aes(x = year, y = value, color = factor(year))) +\n  # Background mapped to the verbose label (shows legend like his)\n  geom_rect(\n    data = bg_df,\n    inherit.aes = FALSE,\n    aes(\n      xmin = xmin,\n      xmax = xmax,\n      ymin = ymin,\n      ymax = ymax,\n      fill = group_label\n    ),\n    alpha = 1 / 6,\n    color = NA\n  ) +\n  scale_fill_manual(name = NULL,\n                    values = setNames(c(\"#0063B2\", \"grey95\"), c(\n                      sprintf(\"Rain (%d) per station > Rain (%d) per station\", year_b, year_a),\n                      sprintf(\"Rain (%d) per station < Rain (%d) per station\", year_b, year_a)\n                    )),\n                    na.translate = FALSE) +\n  ggnewscale::new_scale_fill() +   # reset fill for points\n  geom_line(aes(group = station),\n            show.legend = F,\n            color = \"#000000\") +\n  geom_hline(yintercept = 0,\n             color = \"grey10\",\n             size = .3) +\n  geom_point(\n    aes(fill = factor(year)),\n    show.legend = F,\n    size = 2,\n    stroke = 0.5,\n    shape = 21,\n    color = \"#ffffff\"\n  ) +\n  geom_text(\n    aes(label = round(value), color = factor(year)),\n    show.legend = F,\n    size = 2.8,\n    fontface = \"bold\",\n    vjust = 1.7\n  ) +\n  scale_color_manual(values = rev(c(\"#0063B2\", \"grey50\"))) +\n  scale_fill_manual(values = rev(c(\"#0063B2\", \"grey50\"))) +\n  facet_geo( ~ station, grid = grid_use2, label = \"name\") +\n  scale_x_continuous(limits = c(2022.7, 2024.3),\n                     breaks = c(2023, 2024)) +\n  scale_y_continuous(breaks = seq(0, 2000, by = 1000), limit = c(0, 2100)) +\n  coord_cartesian(clip = \"off\", expand = F) +\n  labs(\n    title = title,\n    subtitle = subtitle,\n    caption = cap,\n    x = NULL,\n    y = \"Total Annual Rainfall (mm)\"\n  ) +\n  theme(\n    text = element_text(family = \"Roboto\"),\n    axis.text = element_text(color = \"#999999\", size = 7.5),\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.title = element_textbox_simple(\n      face = \"bold\",\n      size = 20,\n      margin = margin(b = 15)\n    ),\n    plot.subtitle = element_textbox_simple(\n      maxwidth = 0.45,\n      halign = 0,\n      hjust = 0,\n      lineheight = 1.2,\n      margin = margin(b = -55)\n    ),\n    plot.caption = element_textbox_simple(size = 7, margin = margin(t = 10)),\n    strip.background = element_blank(),\n    panel.grid = element_blank(),\n    panel.grid.major.y = element_line(size = 0.3, color = \"grey75\"),\n    strip.text.x = element_text(size = 10),\n    axis.ticks.y = element_blank(),\n    legend.position = c(0.73, 1.07),\n    legend.key.size = unit(0.3, \"cm\"),\n    legend.key = element_rect(colour = \"grey60\"),\n    legend.text = element_text(size = 7),\n    legend.background = element_rect(fill = \"grey95\"),\n    plot.margin = margin(10, 10, 10, 10)\n  )\n```\n:::\n\n\n#### 7. üíæ Save\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot for TidyTuesday 2025, Week 42 with specified dimensions.\nandresutils::save_plot(p, type = \"tidytuesday\", year = 2025, week = 42, width = 10, height = 10)\n```\n:::\n\n\n#### 8. üöÄ GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_42_2025.qmd`](https://github.com/OKcomputer626/Andres-Portfolio/blob/master/visualization/TidyTuesday/2024/tt_42_2025.qmd).\n\nFor the full repository, [click here](https://github.com/OKcomputer626/Andres-Portfolio).\n:::\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}