{
  "hash": "7149ac9621f67fb974f34a502236dea7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Agencies from the FBI Crime Data\"\ndescription: \"This map shows the number of law enforcement agencies in California that report crime data to the FBI‚Äôs National Incident-Based Reporting System (NIBRS).\"\nlightbox: true\ndate: February 20, 2025\ncategories: [TidyTuesday, R Programming, Data Visualization, Crime Data]\ntags: [ggplot2, data-visualization, tidyverse, Crime Data]\nimage: \"tt_07_2025.png\"\neditor_options: \n  chunk_output_type: inline\n---\n\n\n\n![This map was created using ggplot2, cowplot, and other R packages to visualize California's county-level NIBRS participation. The FBI Crime Data was processed by filtering for California, wrangling the data to extract agency counts and proportions, and then joining it with county map data, resulting in 73.7% of agencies reporting to NIBRS, while 26.3% do not. This analysis highlights the extent of NIBRS participation across California, offering a clearer picture of crime data reporting at the county level.](tt_07_2025.png){#fig-1}\n\n### <mark> **How This Graphic Was Made** </mark>\n\n#### 1. üì¶ Load Packages & Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary packages using pacman for easier dependency management\npacman::p_load(\n  tidyverse,   # Collection of R packages for data science, includes ggplot2 (visualization), dplyr (data manipulation), readr (data import)\n  showtext,    # Enables custom fonts in ggplot2, allowing for enhanced typography in plots\n  ggtext,      # Adds support for Markdown and HTML formatting in ggplot2 text elements (e.g., bold, italic, colored text)\n  skimr,       # Provides detailed summary statistics in a readable and concise format for data exploration\n  glue,        # Constructs strings efficiently using variable interpolation\n  janitor,     # Simplifies data cleaning (e.g., renaming columns, removing duplicates, formatting variable names)\n  paletteer,   # Provides access to a wide range of color palettes for consistent and visually appealing plots\n  cowplot      # Enhances ggplot2 with better layout and annotation options, useful for combining multiple plots\n)\n\n# Add Google fonts\nfont_add_google(\"Oswald\", family = \"Oswald\")\nfont <- \"Oswald\"\n\n# Add local font\nfont_add(\"Font Awesome 6 Brands\", here::here(\"fonts/otfs/Font Awesome 6 Brands-Regular-400.otf\"))\n\n# Automatically enable the use of showtext for all plots\nshowtext_auto()\n\n# Set DPI for high-resolution text rendering\nshowtext_opts(dpi = 300)\n```\n:::\n\n\n\n#### 2. üìñ Read in the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the TidyTuesday dataset for Week 07 of 2025\ntuesdata <- tidytuesdayR::tt_load(2025, week = 07)\n\n# Extract and clean column names in the agencies dataset\nagencies <- tuesdata$agencies %>%\n  clean_names()\n\n# Display dataset information from TidyTuesday\ntidytuesdayR::readme(tuesdata)\n\n# Remove the original loaded list to free memory\nrm(tuesdata)\n```\n:::\n\n\n\n#### 3. üïµÔ∏è Examine the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display the structure of the agencies dataset, including column types and sample values\nglimpse(agencies)\n\n# Generate a detailed summary of the agencies dataset, including distribution and missing values\nskim(agencies)\n```\n:::\n\n\n\n#### 4. ü§º Wrangle Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get California county map data\nca_counties <- subset(map_data(\"county\"), region == \"california\")\n\n# Filter agencies for California and format county names\ncalifornia <- agencies %>%\n  filter(state_abbr == \"CA\") %>%\n  mutate(county = str_to_lower(county)) %>%\n  group_by(county, is_nibrs) %>%\n  count(is_nibrs) %>%\n  ungroup()\n\n# Calculate the percentage of agencies reporting to NIBRS in California\nperc <- california %>%\n  group_by(is_nibrs) %>%\n  summarise(count = sum(n)) %>%\n  mutate(proportion = round(count / sum(count) * 100, 1)) %>%\n  ungroup() %>%\n  pull(proportion)\n  \n# Merge California county map data with agency data\ncalifornia <- ca_counties %>%\n  left_join(california, by = join_by(subregion == county))\n\n# Extract data for Los Angeles County\nlos_angeles <- california %>%\n  filter(subregion == \"los angeles\")\n```\n:::\n\n\n\n#### 5. üî§ Text\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define the main title for the visualization\ntitle <- \"California Agencies on the FBI‚Äôs\\nNational Incident-Based Reporting System (NIBRS)\"\n\n# Create a short description of the dataset focus\nst <- \"The FBI Crime Data Explorer provides access to crime data from\\nlaw enforcement agencies nationwide. This dataset focuses on California agencies\\nthat report through the National Incident-Based Reporting System (NIBRS).\"\n\n# Highlight key insight about agency participation in Los Angeles County\ntext <- \"Los Angeles County has the highest number\\nof agencies participating in NIBRS, with a total of 61.\"\n\n# Generate the formatted text\ncal_perc <- glue(\"In California, {perc[2]}% of agencies report to NIBRS, while {perc[1]}% do not.\")\n\n# Generate a social media caption with custom colors and font styling\nsocial <- andresutils::social_caption(font_family = font, icon_color = \"#b2d8ee\", bg_color = \"gray10\", font_color = \"white\") \n\n# Construct the final plot caption with TidyTuesday details, data source, and social caption\ncap <- paste0(\n  \"#TidyTuesday: Week 07, 2025 | **Source**: FBI Crime Data API | **Graphic**: \", social\n)\n```\n:::\n\n\n\n#### 6. üìä Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a base map of California showing NIBRS-participating agencies\np <- california %>%\n  filter(is_nibrs == \"TRUE\") %>%\n  ggplot() +\n  geom_polygon(aes(x = long, y = lat, group = group, fill = n), color = \"gray50\") +\n  geom_polygon(data = los_angeles, aes(x = long, y = lat, group = group), color = \"#EFBF04\", fill = NA, size = 1.5) +\n  scale_fill_paletteer_c(\"ggthemes::Blue\") +\n  labs(caption = cap) +\n  theme_void() +\n  theme(\n    legend.position = c(0.15, 0.2),\n    legend.key.width = unit(1.2, \"cm\"),\n    legend.key.height = unit(1.8, \"cm\"),\n    legend.title = element_blank(),\n    legend.text = element_text(color=\"white\", size = 22, family = font, face = \"bold\"),\n    plot.background = element_rect(fill = \"gray10\", color = \"transparent\"),\n    plot.caption = element_textbox_simple(color = \"white\", family = font, size = 10)\n  )\n\n# Add text, labels, and annotations to the map\np1 <- ggdraw(p) +\n  draw_text(text = title, x = 0.72, y = 0.9, size = 20, color = \"white\", family = font, fontface = \"bold\") +\n  draw_text(text = \"Number of Agencies\", color = \"white\", x = 0.09, y = 0.2, size = 21, family = font, fontface = \"bold\", angle = 90) +\n  draw_text(text = text, x = 0.43, y = 0.12, color = \"white\", family = font) +\n  annotate(\"curve\", x = 0.45, y = 0.14, xend = 0.57, yend = 0.21, color = \"white\", curvature = -0.2, linewidth = 0.7, arrow = arrow(length = unit(0.4, 'cm'))) +\n  draw_text(text = st, x = 0.72, y = 0.82, color = \"white\", family = font) +\n  draw_text(text = cal_perc, x= 0.68, y = 0.5, color = \"white\", family = font, angle = -45, size = 18)\n```\n:::\n\n\n\n#### 7. üíæ Save\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot for TidyTuesday 2025, Week 07 with specified dimensions.\nandresutils::save_plot(p1, type = \"tidytuesday\", year = 2025, week = 7, width = 11, height = 14)\n```\n:::\n\n\n\n#### 8. üöÄ GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_07_2025.qmd`](https://github.com/OKcomputer626/Andres-Portfolio/blob/master/visualization/TidyTuesday/2025/Week_07/tt_07_2025.qmd).\n\nFor the full repository, [click here](https://github.com/OKcomputer626/Andres-Portfolio).\n:::\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}